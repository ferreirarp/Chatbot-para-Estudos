<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Educacional - Estudos para Prova</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 800px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .chat-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            text-align: right;
        }

        .bot-message {
            text-align: left;
        }

        .message-bubble {
            display: inline-block;
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
            position: relative;
        }

        .user-message .message-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .bot-message .message-bubble {
            background: white;
            color: #333;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 5px;
        }

        .input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .student-info {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .student-info input {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
        }

        .student-info input:focus {
            outline: none;
            border-color: #667eea;
        }

        #messageInput {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            resize: none;
            min-height: 50px;
            max-height: 120px;
        }

        #messageInput:focus {
            outline: none;
            border-color: #667eea;
        }

        .send-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: transform 0.2s;
        }

        .send-btn:hover {
            transform: scale(1.1);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .admin-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 1000;
            min-width: 200px;
        }

        .admin-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 12px;
        }

        .admin-btn:hover {
            background: #218838;
        }

        .typing-indicator {
            display: none;
            text-align: left;
            margin-bottom: 15px;
        }

        .typing-indicator .message-bubble {
            background: white;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 5px;
        }

        .dots {
            display: inline-block;
            width: 40px;
            text-align: center;
        }

        .dots span {
            display: inline-block;
            background: #667eea;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin: 0 1px;
            animation: bounce 1.4s infinite ease-in-out;
        }

        .dots span:nth-child(1) { animation-delay: -0.32s; }
        .dots span:nth-child(2) { animation-delay: -0.16s; }
        .dots span:nth-child(3) { animation-delay: 0s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        @media (max-width: 600px) {
            .container {
                height: 100vh;
                border-radius: 0;
            }
            
            .admin-panel {
                position: relative;
                top: 0;
                right: 0;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Assistente de Estudos</h1>
            <p>Tire suas d√∫vidas sobre o conte√∫do da prova</p>
        </div>

        <div class="chat-area" id="chatArea">
            <div class="warning">
                <strong>‚ö†Ô∏è Importante:</strong> Este chatbot s√≥ pode ajudar com os conte√∫dos espec√≠ficos da prova. Outras perguntas n√£o ser√£o respondidas.
            </div>
            
            <div class="message bot-message">
                <div class="message-bubble">
                    Ol√°! üëã Eu sou seu assistente de estudos. Estou aqui para ajudar voc√™ a estudar para a prova.<br><br>
                    Antes de come√ßarmos, por favor me diga seu nome para que possamos ter uma conversa mais personalizada!
                </div>
            </div>

            <div class="typing-indicator" id="typingIndicator">
                <div class="message-bubble">
                    <div class="dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="input-area">
            <div class="student-info" id="studentInfo">
                <input type="text" id="studentName" placeholder="Seu nome completo" required>
                <input type="text" id="studentId" placeholder="Matr√≠cula (opcional)">
                <button class="admin-btn" onclick="setStudentInfo()">Confirmar</button>
            </div>
            <div id="chatInterface" style="display: none; flex: 1; display: flex; gap: 10px;">
                <textarea id="messageInput" placeholder="Digite sua pergunta sobre o conte√∫do da prova..."></textarea>
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">üì§</button>
            </div>
        </div>
    </div>

    <div class="admin-panel">
        <h4>üîß Painel do Professor</h4>
        <button class="admin-btn" onclick="exportConversations()">üìÑ Exportar Conversas</button>
        <button class="admin-btn" onclick="clearAllData()">üóëÔ∏è Limpar Dados</button>
        <button class="admin-btn" onclick="showStats()">üìä Estat√≠sticas</button>
    </div>

    <script>
        // Configura√ß√£o do conte√∫do da prova (PERSONALIZE AQUI)
        const CONTEUDO_PROVA = {
            "matematica": [
                "equa√ß√µes do segundo grau",
                "fun√ß√µes quadr√°ticas",
                "sistemas de equa√ß√µes",
                "geometria anal√≠tica",
                "trigonometria b√°sica"
            ],
            "fisica": [
                "leis de Newton",
                "cinem√°tica",
                "din√¢mica",
                "energia mec√¢nica",
                "ondas e som"
            ],
            "historia": [
                "revolu√ß√£o industrial",
                "primeira guerra mundial",
                "segunda guerra mundial",
                "guerra fria",
                "ditadura militar no Brasil"
            ]
        };

        // Perguntas e respostas pr√©-definidas (PERSONALIZE AQUI)
        const PERGUNTAS_RESPOSTAS = {
            "o que √© equa√ß√£o do segundo grau": "Uma equa√ß√£o do segundo grau √© uma equa√ß√£o polinomial de grau 2, na forma ax¬≤ + bx + c = 0, onde a ‚â† 0. Pode ser resolvida usando a f√≥rmula de Bhaskara: x = (-b ¬± ‚àö(b¬≤-4ac)) / 2a",
            
            "primeira lei de newton": "A primeira lei de Newton, tamb√©m conhecida como Lei da In√©rcia, estabelece que um corpo em repouso permanece em repouso e um corpo em movimento permanece em movimento com velocidade constante, a menos que uma for√ßa externa atue sobre ele.",
            
            "o que foi a revolu√ß√£o industrial": "A Revolu√ß√£o Industrial foi um per√≠odo de grandes transforma√ß√µes econ√¥micas, tecnol√≥gicas e sociais que come√ßou na Inglaterra no s√©culo XVIII. Caracterizou-se pela mecaniza√ß√£o da produ√ß√£o, urbaniza√ß√£o e mudan√ßas nas rela√ß√µes de trabalho.",
            
            "como calcular fun√ß√£o quadr√°tica": "Uma fun√ß√£o quadr√°tica tem a forma f(x) = ax¬≤ + bx + c. Para encontrar o v√©rtice, use x = -b/2a. O discriminante Œî = b¬≤ - 4ac determina se h√° ra√≠zes reais (Œî ‚â• 0) ou complexas (Œî < 0)."
        };

        let currentStudent = null;
        let conversationHistory = [];
        let allConversations = JSON.parse(localStorage.getItem('allConversations') || '[]');

        function setStudentInfo() {
            const name = document.getElementById('studentName').value.trim();
            if (!name) {
                alert('Por favor, digite seu nome!');
                return;
            }

            const studentId = document.getElementById('studentId').value.trim();
            currentStudent = {
                name: name,
                id: studentId || 'N/A',
                timestamp: new Date().toLocaleString('pt-BR')
            };

            document.getElementById('studentInfo').style.display = 'none';
            document.getElementById('chatInterface').style.display = 'flex';

            // Mensagem de boas-vindas personalizada
            addMessage(`Ol√°, ${name}! üòä Agora podemos come√ßar. Fa√ßa suas perguntas sobre o conte√∫do da prova e eu te ajudarei a estudar!`, 'bot');
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;

            addMessage(message, 'user');
            input.value = '';

            // Mostrar indicador de digita√ß√£o
            showTypingIndicator();

            // Simular delay de resposta
            setTimeout(() => {
                const response = generateResponse(message);
                hideTypingIndicator();
                addMessage(response, 'bot');
            }, 1000 + Math.random() * 2000);
        }

        function addMessage(text, sender) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = 'message-bubble';
            bubbleDiv.innerHTML = text.replace(/\n/g, '<br>');
            
            messageDiv.appendChild(bubbleDiv);
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;

            // Salvar na conversa atual
            conversationHistory.push({
                text: text,
                sender: sender,
                timestamp: new Date().toLocaleString('pt-BR')
            });

            // Salvar conversa completa
            saveConversation();
        }

        function generateResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Verificar se a pergunta est√° relacionada ao conte√∫do da prova
            const isValidTopic = checkIfValidTopic(lowerMessage);
            
            if (!isValidTopic) {
                return "üö´ Desculpe, s√≥ posso ajudar com quest√µes relacionadas ao conte√∫do da prova. Por favor, fa√ßa perguntas sobre os temas que ser√£o cobrados no exame.";
            }

            // Buscar resposta nas perguntas pr√©-definidas
            for (const [pergunta, resposta] of Object.entries(PERGUNTAS_RESPOSTAS)) {
                if (lowerMessage.includes(pergunta.toLowerCase())) {
                    return resposta;
                }
            }

            // Respostas gen√©ricas baseadas no conte√∫do
            if (lowerMessage.includes('equa√ß√£o')) {
                return "üìê Sobre equa√ß√µes: lembre-se de sempre isolar a vari√°vel e verificar suas solu√ß√µes. Precisa de ajuda com algum tipo espec√≠fico de equa√ß√£o?";
            }
            
            if (lowerMessage.includes('newton') || lowerMessage.includes('for√ßa')) {
                return "‚öñÔ∏è As leis de Newton s√£o fundamentais! Primeira lei (in√©rcia), segunda lei (F=ma) e terceira lei (a√ß√£o e rea√ß√£o). Sobre qual lei voc√™ gostaria de saber mais?";
            }
            
            if (lowerMessage.includes('revolu√ß√£o') || lowerMessage.includes('industrial')) {
                return "üè≠ A Revolu√ß√£o Industrial transformou a sociedade! Marcou a transi√ß√£o da produ√ß√£o manual para a mecanizada. Quer saber sobre suas fases ou consequ√™ncias?";
            }

            // Resposta padr√£o para t√≥picos v√°lidos
            return "ü§î Essa √© uma boa pergunta sobre o conte√∫do da prova! Pode ser mais espec√≠fico? Isso me ajudar√° a dar uma resposta mais detalhada e √∫til para seus estudos.";
        }

        function checkIfValidTopic(message) {
            const validKeywords = [
                ...CONTEUDO_PROVA.matematica,
                ...CONTEUDO_PROVA.fisica,
                ...CONTEUDO_PROVA.historia,
                'equa√ß√£o', 'fun√ß√£o', 'sistema', 'geometria', 'trigonometria',
                'newton', 'for√ßa', 'movimento', 'energia', 'onda',
                'revolu√ß√£o', 'guerra', 'ditadura', 'industrial', 'fria'
            ];

            return validKeywords.some(keyword => 
                message.toLowerCase().includes(keyword.toLowerCase())
            );
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'block';
            document.getElementById('chatArea').scrollTop = document.getElementById('chatArea').scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function saveConversation() {
            if (!currentStudent) return;

            const existingIndex = allConversations.findIndex(conv => 
                conv.student.name === currentStudent.name && conv.student.id === currentStudent.id
            );

            const conversationData = {
                student: currentStudent,
                messages: conversationHistory,
                lastUpdate: new Date().toLocaleString('pt-BR')
            };

            if (existingIndex !== -1) {
                allConversations[existingIndex] = conversationData;
            } else {
                allConversations.push(conversationData);
            }

            localStorage.setItem('allConversations', JSON.stringify(allConversations));
        }

        function exportConversations() {
            if (allConversations.length === 0) {
                alert('Nenhuma conversa para exportar!');
                return;
            }

            let content = "RELAT√ìRIO DE CONVERSAS DO CHATBOT EDUCACIONAL\n";
            content += "=" + "=".repeat(50) + "\n\n";
            content += `Gerado em: ${new Date().toLocaleString('pt-BR')}\n`;
            content += `Total de conversas: ${allConversations.length}\n\n`;

            allConversations.forEach((conv, index) => {
                content += `CONVERSA ${index + 1}\n`;
                content += "-".repeat(30) + "\n";
                content += `Estudante: ${conv.student.name}\n`;
                content += `Matr√≠cula: ${conv.student.id}\n`;
                content += `Iniciada em: ${conv.student.timestamp}\n`;
                content += `√öltima atualiza√ß√£o: ${conv.lastUpdate}\n`;
                content += `Total de mensagens: ${conv.messages.length}\n\n`;

                conv.messages.forEach((msg, msgIndex) => {
                    const sender = msg.sender === 'user' ? 'ESTUDANTE' : 'CHATBOT';
                    content += `[${msg.timestamp}] ${sender}: ${msg.text}\n\n`;
                });

                content += "\n" + "=".repeat(60) + "\n\n";
            });

            // Criar e baixar arquivo
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `conversas_chatbot_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function clearAllData() {
            if (confirm('Tem certeza que deseja limpar todos os dados? Esta a√ß√£o n√£o pode ser desfeita!')) {
                localStorage.removeItem('allConversations');
                allConversations = [];
                alert('Todos os dados foram limpos!');
            }
        }

        function showStats() {
            const totalConversations = allConversations.length;
            const totalMessages = allConversations.reduce((sum, conv) => sum + conv.messages.length, 0);
            const studentsWithMessages = allConversations.filter(conv => conv.messages.length > 2).length;

            alert(`üìä ESTAT√çSTICAS\n\n` +
                  `Total de conversas: ${totalConversations}\n` +
                  `Total de mensagens: ${totalMessages}\n` +
                  `Estudantes ativos: ${studentsWithMessages}\n` +
                  `M√©dia de mensagens por conversa: ${totalConversations > 0 ? Math.round(totalMessages / totalConversations) : 0}`);
        }

        // Event listeners
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        document.getElementById('studentName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                setStudentInfo();
            }
        });

        document.getElementById('studentId').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                setStudentInfo();
            }
        });

        // Carregar conversas existentes ao iniciar
        window.addEventListener('load', function() {
            console.log('Chatbot Educacional carregado!');
            console.log(`Total de conversas salvas: ${allConversations.length}`);
        });
    </script>
</body>
</html>